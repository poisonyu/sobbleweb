<html>
    <head>
	<title>vditor编辑器</title>
     <link rel="stylesheet" href="https://unpkg.com/vditor/dist/index.css" />
    <script src="https://unpkg.com/vditor/dist/index.min.js"></script>
    </head>    
    <body>
        {{ template "editor.html" . }}

        <script>
            var vditor = null;
            window.onload = function() {
                vditor = new Vditor(document.getElementById('content'), {
                    cache: {
                        enable: false
                    },
                    "mode": "sv",
                    "preview": {
                        "mode": "both"
                    }
                });

            }
			// 测试数据填充
            function setContent() {
                vditor.setValue("## 测试 \n ### 二级标题 ");
            }

            function saveContent() {
                var htmlContent = vditor.getHTML();
                var re = new RegExp("<h1>(.*?)<");
                // todo 没有匹配到结果的情况
                var title = htmlContent.match(re)[1];
                fetch("/article/add", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "nickname":"",
                        "title": title,
                        "type":"",
                        "content": htmlContent,
                        "ishtml": true,
                    })
                })
                .then(response => callback(response))
                // .then(response => response.json())
                // .then(data => console.log(data.message))

            }

            function callback(response) {
                console.log(response)
                if (response.redirected) {
                    // alert("发布成功");
                    window.location = response.url
                }
            }
        </script>
    </body>
</html>